{
  "$schema": "http://json-schema.org/draft-2020-12/schema",
  "$id": "https://pcl-labs/schema/manifest.schema.json",
  "title": "Daily Recap Manifest",
  "type": "object",
  "required": ["schema_version","post_id","date_utc","tz","title","summary","tags","clip_ids","sections","canonical_vod","md_path","target_branch","status"],
  "properties": {
    "schema_version": { "type": "string", "const": "1.0.0" },
    "post_id": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
    "date_utc": { "type": "string", "format": "date-time" },
    "tz": { "type": "string" },
    "title": { "type": "string" },
    "headline_short": { "type": "string", "maxLength": 60 },
    "summary": { "type": "string", "maxLength": 180 },
    "description": { "type": ["string","null"] },
    "category": { "type": "string", "const": "development" },
    "tags": { "type": "array", "minItems": 1, "uniqueItems": true, "items": { "type": "string" } },
    "repos": { "type": ["array","null"], "items": { "type": "string" }, "minItems": 1, "uniqueItems": true },
    "keywords": { "type": ["string","null"] },
    "clip_ids": { "type": "array", "minItems": 1, "uniqueItems": true, "items": { "type": "string" } },

    "sections": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["section_id","clip_id","title","bullets","paragraph","start","end"],
        "properties": {
          "section_id": { "type": "string" },
          "clip_id": { "type": "string" },
          "title": { "type": "string", "maxLength": 80 },
          "bullets": { "type": "array", "minItems": 2, "maxItems": 4, "uniqueItems": true, "items": { "type": "string", "maxLength": 140 } },
          "paragraph": { "type": "string" },
          "score": { "type": "number", "minimum": 0, "maximum": 1 },
          "repo": { "type": ["string","null"] },
          "pr_links": { "type": ["array","null"], "items": { "type": "string", "format": "uri" }, "minItems": 1, "uniqueItems": true },
          "clip_url": { "type": ["string","null"], "format": "uri" },
          "vod_jump": { "type": ["string","null"], "format": "uri" },
          "alignment_status": { "type": "string", "enum": ["exact","estimated","missing"], "default": "exact" },
          "start": { "type": "number" },
          "end": { "type": "number" },
          "entities": { "type": ["array","null"], "items": { "type": "string" }, "minItems": 1, "uniqueItems": true }
        },
        "additionalProperties": false
      }
    },

    "canonical_vod": { "type": "string", "format": "uri" },
    "md_path": { "type": "string", "pattern": "^content/blog/development/.+\\.md$" },
    "target_branch": { "type": "string", "enum": ["staging","main"] },
    "status": { "type": "string", "enum": ["draft","pr_open","approved","merged","published"] },

    "judge": {
      "type": ["object","null"],
      "properties": {
        "overall": { "type": ["number","null"] },
        "per_axis": { "type": ["object","null"] },
        "version": { "type": ["string","null"] }
      },
      "additionalProperties": false
    },

    "social_blurbs": {
      "type": ["object","null"],
      "properties": {
        "bluesky": { "type": ["string","null"], "maxLength": 260 },
        "threads": { "type": ["string","null"], "maxLength": 260 }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
